<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--      
	This file is automatically generated by autoCode(https://git.oschina.net/durcframework/autoCode)
-->
<mapper namespace="com.info.back.dao.IMmanLoanCollectionOrderDao">
	<resultMap id="queryResultMap" type="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">
		<result column="id" property="id" jdbcType="VARCHAR"/>
		<!-- 催收订单id -->
		<result column="order_id" property="orderId" jdbcType="VARCHAR"/>
		<!-- 借款用户ID -->
		<result column="user_id" property="userId" jdbcType="VARCHAR"/>
		<!-- 借款ID -->
		<result column="loan_id" property="loanId" jdbcType="VARCHAR"/>
		<!-- 还款ID -->
		<result column="pay_id" property="payId" jdbcType="VARCHAR"/>
		<!-- 派单人 -->
		<result column="dispatch_name" property="dispatchName" jdbcType="VARCHAR"/>
		<!-- 派单时间 -->
		<result column="dispatch_time" property="dispatchTime" jdbcType="TIMESTAMP"/>
		<!-- 上一催收员ID -->
		<result column="last_collection_user_id" property="lastCollectionUserId" jdbcType="VARCHAR"/>
		<!-- 当前催收员ID -->
		<result column="current_collection_user_id" property="currentCollectionUserId" jdbcType="VARCHAR"/>
		<!-- 当前逾期等级（即逾期字典分组） -->
		<result column="current_overdue_level" property="currentOverdueLevel" jdbcType="VARCHAR"/>
		<!-- 逾期天数 -->
		<result column="overdueDays" property="overdueDays" jdbcType="INTEGER"/>
		<!-- s1审批人ID -->
		<result column="m1_approve_id" property="m1ApproveId" jdbcType="VARCHAR"/>
		<!-- s1审批人操作状态（1，已操作过，0或null未操作过） -->
		<result column="m1OperateStatus" property="m1OperateStatus" jdbcType="VARCHAR"/>
		<!-- s2审批人ID -->
		<result column="m2_approve_id" property="m2ApproveId" jdbcType="VARCHAR"/>
		<!-- s2审批人操作状态（1，已操作过，0或null未操作过） -->
		<result column="m2OperateStatus" property="m2OperateStatus" jdbcType="VARCHAR"/>
		<!-- m1-m2审批人ID -->
		<result column="m3_approve_id" property="m3ApproveId" jdbcType="VARCHAR"/>
		<!-- m1-m2审批人操作状态（1，已操作过，0或null未操作过） -->
		<result column="m3OperateStatus" property="m3OperateStatus" jdbcType="VARCHAR"/>
		<!-- m2-m3审批人ID -->
		<result column="m4_approve_id" property="m4ApproveId" jdbcType="VARCHAR"/>
		<!-- m2-m3审批人操作状态（1，已操作过，0或null未操作过） -->
		<result column="m4OperateStatus" property="m4OperateStatus" jdbcType="VARCHAR"/>
		<!-- m3+审批人ID -->
		<result column="m5_approve_id" property="m5ApproveId" jdbcType="VARCHAR"/>
		<!-- m3+审批人操作状态（1，已操作过，0或null未操作过） -->
		<result column="m5OperateStatus" property="m5OperateStatus" jdbcType="VARCHAR"/>
		<!-- m6审批人ID -->
		<result column="m6_approve_id" property="m6ApproveId" jdbcType="VARCHAR"/>
		<!-- 催收状态 -->
		<result column="status" property="status" jdbcType="VARCHAR"/>
		<!-- 承诺还款时间 -->
		<result column="promise_repayment_time" property="promiseRepaymentTime" jdbcType="TIMESTAMP"/>
		<!-- 最后催收时间 -->
		<result column="last_collection_time" property="lastCollectionTime" jdbcType="TIMESTAMP"/>
		<!-- 创建时间 -->
		<result column="create_date" property="createDate" jdbcType="TIMESTAMP"/>
		<!-- 更新时间 -->
		<result column="update_date" property="updateDate" jdbcType="TIMESTAMP"/>
		<!-- 操作人 -->
		<result column="operator_name" property="operatorName" jdbcType="VARCHAR"/>
		<!-- 备注 -->
		<result column="remark" property="remark" jdbcType="VARCHAR"/>
		<!-- 委外催收人id -->
		<result column="outside_person_id" property="outsidePersonId" jdbcType="VARCHAR"/>
		<!-- 委外前催收状态 -->
		<result column="before_status" property="beforeStatus" jdbcType="VARCHAR"/>
		<!-- 委外机构ID -->
		<result column="outside_company_id" property="outsideCompanyId" jdbcType="VARCHAR"/>
		<!-- 聚立信息报告审核 0 初始 1 申请 2同意 ，3拒绝 -->
		<result column="jxl_status" property="jxlStatus" jdbcType="VARCHAR"/>
		<!-- 是否进行续借出催 1启用 0不启用 -->
		<result column="renew_status" property="renewStatus" jdbcType="VARCHAR"/>
		<!-- 聚信立 报告申请时间 -->
		<result column="jxl_apply_Time" property="jxlApplyTime" jdbcType="TIMESTAMP"/>
		<!-- 聚信立报告审核时间 -->
		<result column="jx_audit_ime" property="jxAuditIme" jdbcType="TIMESTAMP"/>
		<!--留单状态 N: 否, Y：是 -->
		<result column="csstatus" property="csstatus" jdbcType="VARCHAR"/>
		<result column="s1_flag" property="s1Flag" jdbcType="VARCHAR"/>
		<!-- 借款人姓名 -->
		<result column="loan_user_name" property="loanUserName" jdbcType="VARCHAR"/>
		<!-- 借款人电话 -->
		<result column="loan_user_phone" property="loanUserPhone" jdbcType="VARCHAR"/>
		<!-- 减免滞纳金金额-->
		<result column="reduction_money" jdbcType="DECIMAL" property="reductionMoney" />
		<result column="repay_renewal_mark" jdbcType="INTEGER" property="repayRenewalMark" />
	</resultMap>
	
	<select id="getCollectionMyOrderList" resultType="com.info.web.pojo.cspojo.OrderBaseResult" parameterType="HashMap" >
			SELECT 
			  a.`id`,
			  a.`order_id` AS orderId,
			  a.`loan_id` loanId,
			  d.`loan_money` AS loanMoney,
			  a.`overdueDays` AS overdueDays,
			  d.`loan_penalty` AS loanPenlty,
			  a.`status` AS collectionStatus,
			  d.`loan_end_time` AS loanEndTime,
			  a.`last_collection_time` AS lastCollectionTime,
			  a.`promise_repayment_time` AS promiseRepaymentTime,
			  a.`dispatch_time` AS dispatchTime,
			  a.`top_important` AS topImportant,
			  a.dispatch_name AS dispatchName,
			  a.loan_user_name as realName,
			  a.loan_user_phone as phoneNumber,
			  a.real_money as returnMoney,
			  a.`top_important` as topImportant,
			  a.current_overdue_level collectionGroup,
		      a.reduction_money as reductionMoney
			  FROM mman_loan_collection_order a
			  LEFT JOIN mman_user_loan d ON a.loan_id = d.id
			  <include refid="my_base_where"></include>
	</select>
	<select id="getCollectionMyOrderCount" resultType="Integer" parameterType="HashMap" >
		SELECT count(1) FROM mman_loan_collection_order a LEFT JOIN mman_user_loan d ON a.loan_id = d.id
		<include refid="my_base_where"></include>
	</select>
	<sql id="my_base_where">
			<where>
				1=1
				<if test="roleUserId!=null and roleUserId !=''">
					AND a.current_collection_user_id=#{roleUserId}
				</if>
				<if test="CompanyPermissionsList != null and CompanyPermissionsList.size>0 " >
					AND a.`outside_company_id` in  
						<foreach collection="CompanyPermissionsList" close=")" item="items" open="(" separator=",">
							#{items.companyId} 
						</foreach>
				</if>
				<if test="collectionBeginTime!=null">
					<![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') >=  #{collectionBeginTime}  ]]>
				</if>
				<if test="collectionEndTime !=null">
					<![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') <=  #{collectionEndTime}  ]]>
				</if>
				<if test="dispatchBeginTime !=null">
					<![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d') >= #{dispatchBeginTime}  ]]>
				</if>
				<if test="dispatchEndTime !=null">
					<![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d')<=#{dispatchEndTime}  ]]>
				</if>
				<if test="overDueDaysBegin !=null and overDueDaysBegin!=''">
					<![CDATA[ AND a.overdueDays>=#{overDueDaysBegin}  ]]>
				</if>
				<if test="overDueDaysEnd !=null and overDueDaysEnd !=''">
					<![CDATA[ AND a.overdueDays<=#{overDueDaysEnd}  ]]>
				</if>
				<if test="loanRealName !=null and loanRealName!=''">
					AND a.loan_user_name=#{loanRealName}
				</if>
				<if test="loanUserPhone !=null and loanUserPhone!= ''">
					AND a.loan_user_phone=#{loanUserPhone}
				</if>
				<if test="loanId !=null and loanId!=''">
					AND a.`loan_id`=#{loanId}
				</if>
				<if test="companyId !=null and companyId!='' ">
					AND a.outside_company_id=#{companyId}
				</if>
				<if test="status !=null and status!=''">
					AND a.status=#{status}
				</if>
				<if test="topImportant!=null and topImportant!=''">
					AND a.top_important=#{topImportant}
				</if>
				<if test="collectionGroup !=null and collectionGroup !=''">
					AND a.current_overdue_level=#{collectionGroup}
				</if>
			</where>
			<if test="sortBy !=null and sortBy!=''">
				ORDER BY a.${sortBy}
			</if>
			<if test="sortBy =null or sortBy==''">
				ORDER BY a.top_important DESC, a.dispatch_time DESC
			</if>
	</sql>

	<select id="getCollectionOrderList" resultType="com.info.web.pojo.cspojo.OrderBaseResult" parameterType="HashMap">
		SELECT
		<include refid="base_select"></include>
		(select re.content from mman_loan_collection_record re where re.order_id = a.id order by re.create_date desc limit 1) as csContent
		FROM mman_loan_collection_order a
		LEFT JOIN back_user b ON a.`current_collection_user_id` = b.uuid
		LEFT JOIN credit_loan_pay c ON a.pay_id = c.id
		LEFT JOIN mman_user_loan d ON a.loan_id = d.id
		LEFT JOIN mman_loan_collection_company e ON b.`company_id`= e.id
		LEFT JOIN back_user f on a.last_collection_user_id = f.uuid
		<include refid="base_where"></include>
	</select>
	<select id="getCollectionOrderCount" resultType="Integer" parameterType="HashMap" >
		SELECT 
			count(1)
		FROM mman_loan_collection_order a
			LEFT JOIN back_user b ON a.`current_collection_user_id` = b.uuid
			LEFT JOIN credit_loan_pay c ON a.pay_id = c.id
			LEFT JOIN mman_user_loan d ON a.loan_id = d.id
			LEFT JOIN mman_loan_collection_company e ON b.`company_id`= e.id
			<include refid="base_where"></include>
	</select>
	
	<sql id="base_where">
		<where>
			1=1
			<if test="roleUserId!=null and roleUserId !=''">
				AND a.current_collection_user_id=#{roleUserId}
			</if>
			
			<if test="CompanyPermissionsList != null and CompanyPermissionsList.size>0 " >
				AND b.`company_id` in  
					<foreach collection="CompanyPermissionsList" close=")" item="items" open="(" separator=",">
						#{items.companyId} 
					</foreach>
			</if>
			<if test="collectionBeginTime!=null">
				<![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') >=  #{collectionBeginTime}  ]]>
			</if>
			<if test="collectionEndTime !=null">
				<![CDATA[	AND DATE_FORMAT(last_collection_time,'%Y-%m-%d') <=  #{collectionEndTime}  ]]>
			</if>
			<if test="dispatchBeginTime !=null">
				<![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d') >= #{dispatchBeginTime}  ]]>
			</if>
			<if test="dispatchEndTime !=null">
				<![CDATA[	AND DATE_FORMAT(dispatch_time,'%Y-%m-%d')<=#{dispatchEndTime}  ]]>
			</if>
			<if test="overDueDaysBegin !=null and overDueDaysBegin!=''">
				<![CDATA[ AND a.overdueDays>=#{overDueDaysBegin}  ]]>
			</if>
			<if test="overDueDaysEnd !=null and overDueDaysEnd !=''">
				<![CDATA[ AND a.overdueDays<=#{overDueDaysEnd}  ]]>
			</if>
			<if test="loanRealName !=null and loanRealName!=''">
				AND a.loan_user_name like CONCAT('%',#{loanRealName},'%')
			</if>
			<if test="loanUserPhone !=null and loanUserPhone!= ''">
				AND a.loan_user_phone=#{loanUserPhone}
			</if>
			<if test="collectionPhone !=null and collectionPhone!=''">
				AND b.user_mobile=#{collectionPhone}
			</if>
			<if test="collectionRealName !=null and collectionRealName!=''">
				AND b.user_name=#{collectionRealName}
			</if>
			<if test="loanId !=null and loanId!=''">
				AND a.`loan_id`=#{loanId}
			</if>
			<if test="collectionGroup !=null and collectionGroup !=''">
				AND b.group_level=#{collectionGroup}
			</if>
			<if test="companyId !=null and companyId!='' ">
				AND b.company_id=#{companyId}
			</if>
			<if test="status !=null and status!=''">
				AND a.status=#{status}
			</if>
			<if test="topImportant!=null and topImportant!=''">
				AND a.top_important=#{topImportant}
			</if>

			<if test="ids !=null and ids !=''">
				AND a.id in
				<foreach collection="ids" item="item" open="("
						 separator="," close=")">
					#{item}
				</foreach>
			</if>
			<if test="csStatus != null and csStatus != ''">
				AND a.csstatus = #{csStatus}
			</if>
		</where>
		<if test="sortBy !=null and sortBy!='' and hk_sort == null">
			ORDER BY a.${sortBy},a.last_collection_time DESC
		</if>
		<if test="hk_sort != null and hk_sort != ''">
			ORDER BY c.${hk_sort}
		</if>
		<if test="sortBy =null or sortBy==''">
			ORDER BY a.top_important DESC, a.dispatch_time DESC, c.update_Date DESC
		</if>
	</sql>
	
	<sql id="base_select">
		    a.`id`,
			a.`order_id` as orderId,
			a.`loan_id` loanId,
			e.`title`  as companyTile,
			b.`group_level` as collectionGroup,
			a.loan_user_name as realName,
			a.loan_user_phone as  phoneNumber,
			a.real_money as returnMoney,
			d.`loan_money` as loanMoney,
			a.`overdueDays` as overdueDays,
			d.`loan_penalty` as loanPenlty,
			a.`status` as collectionStatus,
			c.`status` as returnStatus,
			c.`real_money` as returnMoney,
			c.`update_Date` as currentReturnDay,
			d.`loan_end_time` as loanEndTime,
			a.`last_collection_time` as lastCollectionTime,
			a.`promise_repayment_time` as promiseRepaymentTime,
			a.`dispatch_time` as dispatchTime,
			a.`top_important` as topImportant,
			a.dispatch_name as dispatchName,
			b.`user_name` as currUserName,
			a.reduction_money as reductionMoney,
			f.user_name as lastUserName,
			a.csstatus as csstatus,
	</sql>
	<!-- 保存,保存不为NULL的字段 -->
	<insert id="saveNotNull" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">INSERT INTO mman_loan_collection_order
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">`id`,</if>
			<if test="orderId != null">`order_id`,</if>
			<if test="userId != null">`user_id`,</if>
			<if test="loanId != null">`loan_id`,</if>
			<if test="payId != null">`pay_id`,</if>  
			<if test="dispatchName != null">`dispatch_name`,</if>  
			<if test="dispatchTime != null">`dispatch_time`,</if>  
			<if test="lastCollectionUserId != null">`last_collection_user_id`,</if>  
			<if test="currentCollectionUserId != null">`current_collection_user_id`,</if>  
			<if test="currentOverdueLevel != null">`current_overdue_level`,</if>  
			<if test="overdueDays != null">`overdueDays`,</if>  
			<if test="m1ApproveId != null">`m1_approve_id`,</if>  
			<if test="m1OperateStatus != null">`m1OperateStatus`,</if>  
			<if test="m2ApproveId != null">`m2_approve_id`,</if>  
			<if test="m2OperateStatus != null">`m2OperateStatus`,</if>  
			<if test="m3ApproveId != null">`m3_approve_id`,</if>  
			<if test="m3OperateStatus != null">`m3OperateStatus`,</if>  
			<if test="m4ApproveId != null">`m4_approve_id`,</if>  
			<if test="m4OperateStatus != null">`m4OperateStatus`,</if>  
			<if test="m5ApproveId != null">`m5_approve_id`,</if>  
			<if test="m5OperateStatus != null">`m5OperateStatus`,</if>  
			<if test="m6ApproveId != null">`m6_approve_id`,</if>  
			<if test="status != null">`status`,</if>  
			<if test="promiseRepaymentTime != null">`promise_repayment_time`,</if>  
			<if test="lastCollectionTime != null">`last_collection_time`,</if>  
			<if test="createDate != null">`create_date`,</if>  
			<if test="updateDate != null">`update_date`,</if>  
			<if test="operatorName != null">`operator_name`,</if>  
			<if test="remark != null">`remark`,</if>  
			<if test="outsidePersonId != null">`outside_person_id`,</if>  
			<if test="beforeStatus != null">`before_status`,</if>  
			<if test="outsideCompanyId != null">`outside_company_id`,</if>  
			<if test="jxlStatus != null">`jxl_status`,</if>  
			<if test="renewStatus != null">`renew_status`,</if>  
			<if test="jxlApplyTime != null">`jxl_apply_Time`,</if>  
			<if test="jxAuditIme != null">`jx_audit_ime`,</if>  
			<if test="csstatus != null">`csstatus`,</if>
			<if test="s1Date != null">`s1_date`,</if>
			<if test="s2Date != null">`s2_date`,</if>
			<if test="s3Date != null">`s3_date`,</if>
			<if test="m1m2Date != null">`m1m2_date`,</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=","> 
			<if test="id != null">#{id,jdbcType=VARCHAR},</if>  
			<if test="orderId != null">#{orderId,jdbcType=VARCHAR},</if>  
			<if test="userId != null">#{userId,jdbcType=VARCHAR},</if>  
			<if test="loanId != null">#{loanId,jdbcType=VARCHAR},</if>  
			<if test="payId != null">#{payId,jdbcType=VARCHAR},</if>  
			<if test="dispatchName != null">#{dispatchName,jdbcType=VARCHAR},</if>  
			<if test="dispatchTime != null">#{dispatchTime,jdbcType=TIMESTAMP},</if>  
			<if test="lastCollectionUserId != null">#{lastCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentCollectionUserId != null">#{currentCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentOverdueLevel != null">#{currentOverdueLevel,jdbcType=VARCHAR},</if>  
			<if test="overdueDays != null">#{overdueDays,jdbcType=INTEGER},</if>  
			<if test="m1ApproveId != null">#{m1ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m1OperateStatus != null">#{m1OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m2ApproveId != null">#{m2ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m2OperateStatus != null">#{m2OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m3ApproveId != null">#{m3ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m3OperateStatus != null">#{m3OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m4ApproveId != null">#{m4ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m4OperateStatus != null">#{m4OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m5ApproveId != null">#{m5ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m5OperateStatus != null">#{m5OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m6ApproveId != null">#{m6ApproveId,jdbcType=VARCHAR},</if>  
			<if test="status != null">#{status,jdbcType=VARCHAR},</if>  
			<if test="promiseRepaymentTime != null">#{promiseRepaymentTime,jdbcType=TIMESTAMP},</if>  
			<if test="lastCollectionTime != null">#{lastCollectionTime,jdbcType=TIMESTAMP},</if>  
			<if test="createDate != null">#{createDate,jdbcType=TIMESTAMP},</if>  
			<if test="updateDate != null">#{updateDate,jdbcType=TIMESTAMP},</if>  
			<if test="operatorName != null">#{operatorName,jdbcType=VARCHAR},</if>  
			<if test="remark != null">#{remark,jdbcType=VARCHAR},</if>  
			<if test="outsidePersonId != null">#{outsidePersonId,jdbcType=VARCHAR},</if>  
			<if test="beforeStatus != null">#{beforeStatus,jdbcType=VARCHAR},</if>  
			<if test="outsideCompanyId != null">#{outsideCompanyId,jdbcType=VARCHAR},</if>  
			<if test="jxlStatus != null">#{jxlStatus,jdbcType=VARCHAR},</if>  
			<if test="renewStatus != null">#{renewStatus,jdbcType=VARCHAR},</if>  
			<if test="jxlApplyTime != null">#{jxlApplyTime,jdbcType=TIMESTAMP},</if>  
			<if test="jxAuditIme != null">#{jxAuditIme,jdbcType=TIMESTAMP},</if>  
			<if test="csstatus != null">#{csstatus,jdbcType=VARCHAR},</if>
			<if test="reductionMoney != null">#{reductionMoney,jdbcType=DECIMAL},</if>
			<if test="s1Date != null">#{s1Date,jdbcType=VARCHAR},</if>
			<if test="s2Date != null">#{s2Date,jdbcType=VARCHAR},</if>
			<if test="s3Date != null">#{s3Date,jdbcType=VARCHAR},</if>
			<if test="m1m2Date != null">#{m1m2Date,jdbcType=VARCHAR},</if>
		</trim>
	</insert>
	<!-- 更新不为NULL的字段 -->
	<update id="updateNotNull" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">UPDATE mman_loan_collection_order
		<set> 
			<if test="orderId != null">order_id=#{orderId,jdbcType=VARCHAR},</if>  
			<if test="userId != null">user_id=#{userId,jdbcType=VARCHAR},</if>  
			<if test="loanId != null">loan_id=#{loanId,jdbcType=VARCHAR},</if>  
			<if test="payId != null">pay_id=#{payId,jdbcType=VARCHAR},</if>  
			<if test="dispatchName != null">dispatch_name=#{dispatchName,jdbcType=VARCHAR},</if>  
			<if test="dispatchTime != null">dispatch_time=#{dispatchTime,jdbcType=TIMESTAMP},</if>  
			<if test="lastCollectionUserId != null">last_collection_user_id=#{lastCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentCollectionUserId != null">current_collection_user_id=#{currentCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentOverdueLevel != null">current_overdue_level=#{currentOverdueLevel,jdbcType=VARCHAR},</if>  
			<if test="overdueDays != null">overdueDays=#{overdueDays,jdbcType=INTEGER},</if>  
			<if test="m1ApproveId != null">m1_approve_id=#{m1ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m1OperateStatus != null">m1OperateStatus=#{m1OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m2ApproveId != null">m2_approve_id=#{m2ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m2OperateStatus != null">m2OperateStatus=#{m2OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m3ApproveId != null">m3_approve_id=#{m3ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m3OperateStatus != null">m3OperateStatus=#{m3OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m4ApproveId != null">m4_approve_id=#{m4ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m4OperateStatus != null">m4OperateStatus=#{m4OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m5ApproveId != null">m5_approve_id=#{m5ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m5OperateStatus != null">m5OperateStatus=#{m5OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m6ApproveId != null">m6_approve_id=#{m6ApproveId,jdbcType=VARCHAR},</if>  
			<if test="status != null">status=#{status,jdbcType=VARCHAR},</if>  
			<if test="promiseRepaymentTime != null">promise_repayment_time=#{promiseRepaymentTime,jdbcType=TIMESTAMP},</if>  
			<if test="lastCollectionTime != null">last_collection_time=#{lastCollectionTime,jdbcType=TIMESTAMP},</if>  
			<if test="createDate != null">create_date=#{createDate,jdbcType=TIMESTAMP},</if>  
			<if test="updateDate != null">update_date=#{updateDate,jdbcType=TIMESTAMP},</if>  
			<if test="operatorName != null">operator_name=#{operatorName,jdbcType=VARCHAR},</if>  
			<if test="remark != null">remark=#{remark,jdbcType=VARCHAR},</if>  
			<if test="outsidePersonId != null">outside_person_id=#{outsidePersonId,jdbcType=VARCHAR},</if>  
			<if test="beforeStatus != null">before_status=#{beforeStatus,jdbcType=VARCHAR},</if>  
			<if test="outsideCompanyId != null">outside_company_id=#{outsideCompanyId,jdbcType=VARCHAR},</if>  
			<if test="jxlStatus != null">jxl_status=#{jxlStatus,jdbcType=VARCHAR},</if>  
			<if test="renewStatus != null">renew_status=#{renewStatus,jdbcType=VARCHAR},</if>  
			<if test="jxlApplyTime != null">jxl_apply_Time=#{jxlApplyTime,jdbcType=TIMESTAMP},</if>  
			<if test="jxAuditIme != null">jx_audit_ime=#{jxAuditIme,jdbcType=TIMESTAMP},</if>  
			<if test="csstatus != null">csstatus=#{csstatus,jdbcType=VARCHAR},</if>
			<if test="s1Date != null">s1_date=#{s1Date,jdbcType=VARCHAR},</if>
			<if test="s2Date != null">s2_date=#{s2Date,jdbcType=VARCHAR},</if>
			<if test="s3Date != null">s3_date=#{s3Date,jdbcType=VARCHAR},</if>
			<if test="m1m2Date != null">m1m2_date=#{m1m2Date,jdbcType=VARCHAR},</if>
		</set> WHERE id = #{id,jdbcType=VARCHAR}
	</update>
	<!-- 根据id获取单条记录 -->
	<select id="getOrderById" resultMap="queryResultMap" parameterType="String">
	SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time ,
	t.jx_audit_ime , t.csstatus , t.loan_user_name , t.loan_user_phone,t.reduction_money, repay_renewal_mark
	FROM mman_loan_collection_order t WHERE id = #{id,jdbcType=VARCHAR}</select>
	<select id="getBaseOrderById" resultType="com.info.web.pojo.cspojo.OrderBaseResult" parameterType="String">
		SELECT
			a.`id` AS  id,
			a.`loan_id` AS loanId,
			d.`loan_money` AS loanMoney,
			a.loan_user_name AS realName,
			a.`overdueDays` AS overdueDays,
			d.`loan_penalty` AS loanPenlty
			FROM mman_loan_collection_order a LEFT JOIN mman_user_loan d ON a.loan_id = d.id
			WHERE a.id=#{orderId}

	</select>

	<select id="getOrderByUserId" resultMap="queryResultMap" parameterType="String">
		SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime , t.csstatus , t.loan_user_name , t.loan_user_phone,t.reduction_money FROM mman_loan_collection_order t WHERE t.user_id = #{userId,jdbcType=VARCHAR}</select>
	<!-- 根据主键获取单条记录 -->
	<select id="get" resultMap="queryResultMap" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime , t.csstatus FROM mman_loan_collection_order t WHERE id = #{id,jdbcType=VARCHAR}</select>
	<!-- 根据主键删除记录 -->
	<delete id="del" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">DELETE FROM mman_loan_collection_order WHERE id = #{id,jdbcType=VARCHAR}</delete>
	
	<select id="findList" resultMap="queryResultMap" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">
		SELECT t.id , 
		t.order_id , 
		t.user_id , 
		t.loan_id , 
		t.pay_id , 
		t.dispatch_name , 
		t.dispatch_time , 
		t.last_collection_user_id , 
		t.current_collection_user_id , 
		t.current_overdue_level , 
		t.overdueDays , 
		t.m1_approve_id , 
		t.m1OperateStatus , 
		t.m2_approve_id , 
		t.m2OperateStatus , 
		t.m3_approve_id , 
		t.m3OperateStatus , 
		t.m4_approve_id , 
		t.m4OperateStatus , 
		t.m5_approve_id , 
		t.m5OperateStatus , 
		t.m6_approve_id , 
		t.status , 
		t.promise_repayment_time , 
		t.last_collection_time , 
		t.create_date , 
		t.update_date , 
		t.operator_name , 
		t.remark , 
		t.outside_person_id , 
		t.before_status , 
		t.outside_company_id ,
		t.jxl_status , 
		t.renew_status , 
		t.jxl_apply_Time ,
		t.jx_audit_ime , 
		t.s1_flag,
	    t.csstatus ,
		t.reduction_money
		FROM mman_loan_collection_order t
		WHERE 1=1 
	 	<if test="id !=null and id !=''">
	 		and id = #{id}
	 	</if> 
	 	<if test="loanId !=null and loanId !=''">
	 		and loan_id = #{loanId}
	 	</if> 
	</select>
	
	
	<insert id="insertCollectionOrder" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">INSERT INTO mman_loan_collection_order
		<trim prefix="(" suffix=")" suffixOverrides=","> 
			<if test="id != null and id!=''">`id`,</if>  
			<if test="orderId != null and orderId!=''">`order_id`,</if>  
			<if test="userId != null and userId!=''">`user_id`,</if>  
			<if test="loanId != null and loanId!=''">`loan_id`,</if>  
			<if test="payId != null and payId!=''">`pay_id`,</if>  
			<if test="dispatchName != null and dispatchName!=''">`dispatch_name`,</if>  
			<if test="dispatchTime != null">`dispatch_time`,</if>  
			<if test="lastCollectionUserId != null and lastCollectionUserId!=''">`last_collection_user_id`,</if>  
			<if test="currentCollectionUserId != null and currentCollectionUserId!=''">`current_collection_user_id`,</if>  
			<if test="currentOverdueLevel != null and currentOverdueLevel!=''">`current_overdue_level`,</if>  
			<if test="overdueDays != null">`overdueDays`,</if>  
			<if test="m1ApproveId != null and m1ApproveId!=''">`m1_approve_id`,</if>  
			<if test="m1OperateStatus != null and m1OperateStatus!=''">`m1OperateStatus`,</if>  
			<if test="m2ApproveId != null and m2ApproveId!=''">`m2_approve_id`,</if>  
			<if test="m2OperateStatus != null and m2OperateStatus!=''">`m2OperateStatus`,</if>  
			<if test="m3ApproveId != null and m3ApproveId!=''">`m3_approve_id`,</if>  
			<if test="m3OperateStatus != null and m3OperateStatus!=''">`m3OperateStatus`,</if>  
			<if test="m4ApproveId != null and m4ApproveId!=''">`m4_approve_id`,</if>  
			<if test="m4OperateStatus != null and m4OperateStatus!=''">`m4OperateStatus`,</if>  
			<if test="m5ApproveId != null and m5ApproveId!=''">`m5_approve_id`,</if>  
			<if test="m5OperateStatus != null and m5OperateStatus!=''">`m5OperateStatus`,</if>  
			<if test="m6ApproveId != null and m6ApproveId!=''">`m6_approve_id`,</if>  
			<if test="status != null and status!=''">`status`,</if>  
			<if test="promiseRepaymentTime != null">`promise_repayment_time`,</if>  
			<if test="lastCollectionTime != null">`last_collection_time`,</if>  
			<if test="createDate != null">`create_date`,</if>  
			<if test="updateDate != null">`update_date`,</if>  
			<if test="operatorName != null and operatorName!=''">`operator_name`,</if>  
			<if test="remark != null and remark!=''">`remark`,</if>  
			<if test="outsidePersonId != null and outsidePersonId!=''">`outside_person_id`,</if>  
			<if test="beforeStatus != null and beforeStatus!=''">`before_status`,</if>  
			<if test="outsideCompanyId != null and outsideCompanyId!=''">`outside_company_id`,</if>  
			<if test="jxlStatus != null and jxlStatus!=''">`jxl_status`,</if>  
			<if test="renewStatus != null and renewStatus!=''">`renew_status`,</if>  
			<if test="jxlApplyTime != null">`jxl_apply_Time`,</if>  
			<if test="jxAuditIme != null">`jx_audit_ime`,</if>  
			<if test="csstatus != null and csstatus!=''">`csstatus`,</if> 
			<if test="s1Flag!= null and s1Flag!=''">s1_flag,</if> 
			<if test="loanUserName!= null and loanUserName!=''">loan_user_name,</if> 
			<if test="loanUserPhone!= null and loanUserPhone!=''">loan_user_phone,</if>
			<if test="s1Date != null">`s1_date`,</if>
			<if test="s2Date != null">`s2_date`,</if>
			<if test="s3Date != null">`s3_date`,</if>
			<if test="m1m2Date != null">`m1m2_date`,</if>
		</trim>  
		<trim prefix="values (" suffix=")" suffixOverrides=","> 
			<if test="id != null and id!=''">#{id,jdbcType=VARCHAR},</if>  
			<if test="orderId != null and orderId!=''">#{orderId,jdbcType=VARCHAR},</if>  
			<if test="userId != null and userId!=''">#{userId,jdbcType=VARCHAR},</if>  
			<if test="loanId != null and loanId!=''">#{loanId,jdbcType=VARCHAR},</if>  
			<if test="payId != null and payId!=''">#{payId,jdbcType=VARCHAR},</if>  
			<if test="dispatchName != null and dispatchName!=''">#{dispatchName,jdbcType=VARCHAR},</if>  
			<if test="dispatchTime != null">#{dispatchTime,jdbcType=TIMESTAMP},</if>  
			<if test="lastCollectionUserId != null and lastCollectionUserId!=''">#{lastCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentCollectionUserId != null and currentCollectionUserId!=''">#{currentCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentOverdueLevel != null and currentOverdueLevel!=''">#{currentOverdueLevel,jdbcType=VARCHAR},</if>  
			<if test="overdueDays != null">#{overdueDays,jdbcType=INTEGER},</if>  
			<if test="m1ApproveId != null and m1ApproveId!=''">#{m1ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m1OperateStatus != null and m1OperateStatus!=''">#{m1OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m2ApproveId != null and m2ApproveId!=''">#{m2ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m2OperateStatus != null and m2OperateStatus!=''">#{m2OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m3ApproveId != null and m3ApproveId!=''">#{m3ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m3OperateStatus != null and m3OperateStatus!=''">#{m3OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m4ApproveId != null and m4ApproveId!=''">#{m4ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m4OperateStatus != null and m4OperateStatus!=''">#{m4OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m5ApproveId != null and m5ApproveId!=''">#{m5ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m5OperateStatus != null and m5OperateStatus!=''">#{m5OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m6ApproveId != null and m6ApproveId!=''">#{m6ApproveId,jdbcType=VARCHAR},</if>  
			<if test="status != null and status!=''">#{status,jdbcType=VARCHAR},</if>  
			<if test="promiseRepaymentTime != null">#{promiseRepaymentTime,jdbcType=TIMESTAMP},</if>  
			<if test="lastCollectionTime != null">#{lastCollectionTime,jdbcType=TIMESTAMP},</if>  
			<if test="createDate != null">#{createDate,jdbcType=TIMESTAMP},</if>  
			<if test="updateDate != null">#{updateDate,jdbcType=TIMESTAMP},</if>  
			<if test="operatorName != null and operatorName!=''">#{operatorName,jdbcType=VARCHAR},</if>  
			<if test="remark != null and remark!=''">#{remark,jdbcType=VARCHAR},</if>  
			<if test="outsidePersonId != null and outsidePersonId!=''">#{outsidePersonId,jdbcType=VARCHAR},</if>  
			<if test="beforeStatus != null and beforeStatus!=''">#{beforeStatus,jdbcType=VARCHAR},</if>  
			<if test="outsideCompanyId != null and outsideCompanyId!=''">#{outsideCompanyId,jdbcType=VARCHAR},</if>  
			<if test="jxlStatus != null and jxlStatus!=''">#{jxlStatus,jdbcType=VARCHAR},</if>  
			<if test="renewStatus != null">#{renewStatus,jdbcType=VARCHAR},</if>  
			<if test="jxlApplyTime != null">#{jxlApplyTime,jdbcType=TIMESTAMP},</if>  
			<if test="jxAuditIme != null">#{jxAuditIme,jdbcType=TIMESTAMP},</if>  
			<if test="csstatus != null and csstatus!=''">#{csstatus,jdbcType=VARCHAR},</if> 
			<if test="s1Flag!= null and s1Flag!=''">#{s1Flag},</if> 
			<if test="loanUserName!= null and loanUserName!=''">#{loanUserName},</if> 
			<if test="loanUserPhone!= null and loanUserPhone!=''">#{loanUserPhone},</if>
			<if test="s1Date != null">#{s1Date,jdbcType=VARCHAR},</if>
			<if test="s2Date != null">#{s2Date,jdbcType=VARCHAR},</if>
			<if test="s3Date != null">#{s3Date,jdbcType=VARCHAR},</if>
			<if test="m1m2Date != null">#{m1m2Date,jdbcType=VARCHAR},</if>
		</trim> 
	</insert>
	
	<!-- 更新不为NULL的字段 -->
	<update id="updateCollectionOrder" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">UPDATE mman_loan_collection_order
		<set> 
			<if test="orderId != null">order_id=#{orderId,jdbcType=VARCHAR},</if>  
			<if test="userId != null">user_id=#{userId,jdbcType=VARCHAR},</if>  
			<if test="loanId != null">loan_id=#{loanId,jdbcType=VARCHAR},</if>  
			<if test="payId != null">pay_id=#{payId,jdbcType=VARCHAR},</if>  
			<if test="dispatchName != null">dispatch_name=#{dispatchName,jdbcType=VARCHAR},</if>  
			<if test="dispatchTime != null">dispatch_time=#{dispatchTime,jdbcType=TIMESTAMP},</if>  
			<if test="lastCollectionUserId != null">last_collection_user_id=#{lastCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentCollectionUserId != null">current_collection_user_id=#{currentCollectionUserId,jdbcType=VARCHAR},</if>  
			<if test="currentOverdueLevel != null">current_overdue_level=#{currentOverdueLevel,jdbcType=VARCHAR},</if>  
			<if test="overdueDays != null">overdueDays=#{overdueDays,jdbcType=INTEGER},</if>  
			<if test="m1ApproveId != null">m1_approve_id=#{m1ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m1OperateStatus != null">m1OperateStatus=#{m1OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m2ApproveId != null and m2ApproveId!=''">m2_approve_id=#{m2ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m2OperateStatus != null and m2OperateStatus!=''">m2OperateStatus=#{m2OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m3ApproveId != null and m3ApproveId!=''">m3_approve_id=#{m3ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m3OperateStatus != null and m3OperateStatus!=''">m3OperateStatus=#{m3OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m4ApproveId != null and m4ApproveId!=''">m4_approve_id=#{m4ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m4OperateStatus != null and m4OperateStatus!=''">m4OperateStatus=#{m4OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m5ApproveId != null and m5ApproveId!=''">m5_approve_id=#{m5ApproveId,jdbcType=VARCHAR},</if>  
			<if test="m5OperateStatus != null and m5OperateStatus!=''">m5OperateStatus=#{m5OperateStatus,jdbcType=VARCHAR},</if>  
			<if test="m6ApproveId != null and m6ApproveId!=''">m6_approve_id=#{m6ApproveId,jdbcType=VARCHAR},</if>  
			<if test="status != null and status!=''">status=#{status,jdbcType=VARCHAR},</if>
			promise_repayment_time=#{promiseRepaymentTime},
			<if test="lastCollectionTime != null">last_collection_time=#{lastCollectionTime,jdbcType=TIMESTAMP},</if>  
			<if test="createDate != null">create_date=#{createDate,jdbcType=TIMESTAMP},</if>  
			<if test="updateDate != null">update_date=#{updateDate,jdbcType=TIMESTAMP},</if>  
			<if test="operatorName != null and operatorName!=''">operator_name=#{operatorName,jdbcType=VARCHAR},</if>  
			<if test="remark != null and remark!=''">remark=#{remark,jdbcType=VARCHAR},</if>  
			<if test="outsidePersonId != null and outsidePersonId!=''">outside_person_id=#{outsidePersonId,jdbcType=VARCHAR},</if>  
			<if test="beforeStatus != null and beforeStatus!=''">before_status=#{beforeStatus,jdbcType=VARCHAR},</if>  
			<if test="outsideCompanyId != null and outsideCompanyId!=''">outside_company_id=#{outsideCompanyId,jdbcType=VARCHAR},</if>  
			<if test="jxlStatus != null and jxlStatus!=''">jxl_status=#{jxlStatus,jdbcType=VARCHAR},</if>  
			<if test="renewStatus != null and renewStatus!=''">renew_status=#{renewStatus,jdbcType=VARCHAR},</if>  
			<if test="jxlApplyTime != null">jxl_apply_Time=#{jxlApplyTime,jdbcType=TIMESTAMP},</if>  
			<if test="jxAuditIme != null">jx_audit_ime=#{jxAuditIme,jdbcType=TIMESTAMP},</if>  
			<if test="csstatus != null and csstatus!=''">csstatus=#{csstatus,jdbcType=VARCHAR},</if> 
			<if test="s1Flag!= null and s1Flag!=''">s1_flag=#{s1Flag},</if> 
			<if test="loanUserName!= null and loanUserName!=''">loan_user_name=#{loanUserName},</if> 
			<if test="loanUserPhone!= null and loanUserPhone!=''">loan_user_phone=#{loanUserPhone},</if>
			<if test="s1Date != null">s1_date=#{s1Date,jdbcType=VARCHAR},</if>
			<if test="s2Date != null">s2_date=#{s2Date,jdbcType=VARCHAR},</if>
			<if test="s3Date != null">s3_date=#{s3Date,jdbcType=VARCHAR},</if>
			<if test="m1m2Date != null">m1m2_date=#{m1m2Date,jdbcType=VARCHAR},</if>
		</set> WHERE id = #{id,jdbcType=VARCHAR}
		<if test="careStatus != null and careStatus != ''">
			and status != #{careStatus,jdbcType=VARCHAR}
		</if>
	</update>
	<!-- 标记订单 -->
	<update id="updateTopOrder" parameterType="HashMap">
		UPDATE mman_loan_collection_order u SET u.`top_important`=#{topLevel},update_date = now() WHERE u.`id`=#{id}
	</update>
		
	<update id="updateAuditStatus" parameterType="HashMap">
		UPDATE mman_loan_collection_order
		<set> 
			<if test="csstatus != null and csstatus !=''">
				csstatus=#{csstatus,jdbcType=VARCHAR},
			</if>  
			<if test="jxlStatus != null and jxlStatus !='' ">
				jxl_status=#{jxlStatus,jdbcType=VARCHAR},
			</if>
			update_date = now()
		</set>
		WHERE id = #{id,jdbcType=VARCHAR}
	</update>
	
	
	<!-- 根据条件查询符合的订单 -->
	<select id="getOrderList" resultMap="queryResultMap" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">
	SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime , t.csstatus FROM mman_loan_collection_order t WHERE 1=1 
			<if test="orderId != null">and order_id=#{orderId,jdbcType=VARCHAR}</if>  
			<if test="userId != null">and user_id=#{userId,jdbcType=VARCHAR}</if>  
			<if test="loanId != null">and loan_id=#{loanId,jdbcType=VARCHAR}</if>  
			<if test="payId != null">and pay_id=#{payId,jdbcType=VARCHAR}</if>  
			<if test="dispatchName != null">and dispatch_name=#{dispatchName,jdbcType=VARCHAR}</if>  
			<if test="dispatchTime != null">and dispatch_time=#{dispatchTime,jdbcType=TIMESTAMP}</if>  
			<if test="lastCollectionUserId != null">and last_collection_user_id=#{lastCollectionUserId,jdbcType=VARCHAR}</if>  
			<if test="currentCollectionUserId != null">and current_collection_user_id=#{currentCollectionUserId,jdbcType=VARCHAR}</if>  
			<if test="currentOverdueLevel != null">and current_overdue_level=#{currentOverdueLevel,jdbcType=VARCHAR}</if>  
			<if test="overdueDays != null">and overdueDays=#{overdueDays,jdbcType=INTEGER}</if>  
			<if test="m1ApproveId != null">and m1_approve_id=#{m1ApproveId,jdbcType=VARCHAR}</if>  
			<if test="m1OperateStatus != null">and m1OperateStatus=#{m1OperateStatus,jdbcType=VARCHAR}</if>  
			<if test="m2ApproveId != null">and m2_approve_id=#{m2ApproveId,jdbcType=VARCHAR}</if>  
			<if test="m2OperateStatus != null">and m2OperateStatus=#{m2OperateStatus,jdbcType=VARCHAR}</if>  
			<if test="m3ApproveId != null">and m3_approve_id=#{m3ApproveId,jdbcType=VARCHAR}</if>  
			<if test="m3OperateStatus != null">and m3OperateStatus=#{m3OperateStatus,jdbcType=VARCHAR}</if>  
			<if test="m4ApproveId != null">and m4_approve_id=#{m4ApproveId,jdbcType=VARCHAR}</if>  
			<if test="m4OperateStatus != null">and m4OperateStatus=#{m4OperateStatus,jdbcType=VARCHAR}</if>  
			<if test="m5ApproveId != null">and m5_approve_id=#{m5ApproveId,jdbcType=VARCHAR}</if>  
			<if test="m5OperateStatus != null">and m5OperateStatus=#{m5OperateStatus,jdbcType=VARCHAR}</if>  
			<if test="m6ApproveId != null">and m6_approve_id=#{m6ApproveId,jdbcType=VARCHAR}</if>  
			<if test="status != null">and status=#{status,jdbcType=VARCHAR}</if>  
			<if test="promiseRepaymentTime != null">and promise_repayment_time=#{promiseRepaymentTime,jdbcType=TIMESTAMP}</if>  
			<if test="lastCollectionTime != null">and last_collection_time=#{lastCollectionTime,jdbcType=TIMESTAMP}</if>  
			<!-- <if test="createDate != null">create_date=#{createDate,jdbcType=TIMESTAMP},</if>  
			<if test="updateDate != null">update_date=#{updateDate,jdbcType=TIMESTAMP},</if>   -->
			<if test="operatorName != null">and operator_name=#{operatorName,jdbcType=VARCHAR}</if>  
			<if test="remark != null">and remark=#{remark,jdbcType=VARCHAR}</if>  
			<if test="outsidePersonId != null">and outside_person_id=#{outsidePersonId,jdbcType=VARCHAR}</if>  
			<if test="beforeStatus != null">and before_status=#{beforeStatus,jdbcType=VARCHAR}</if>  
			<if test="outsideCompanyId != null">and outside_company_id=#{outsideCompanyId,jdbcType=VARCHAR}</if>  
			<if test="jxlStatus != null">and jxl_status=#{jxlStatus,jdbcType=VARCHAR}</if>  
			<if test="renewStatus != null">and renew_status=#{renewStatus,jdbcType=VARCHAR}</if>  
			<if test="csstatus != null">and csstatus=#{csstatus,jdbcType=VARCHAR}</if> 
	</select>

	<select id="getOrderPageCount" resultType="Integer" parameterType="HashMap">
		select count(1)
		FROM mman_loan_collection_order a
		LEFT JOIN back_user b ON a.`current_collection_user_id` = b.uuid
		LEFT JOIN credit_loan_pay c ON a.pay_id = c.id
		LEFT JOIN mman_user_loan d ON a.loan_id = d.id
		LEFT JOIN mman_loan_collection_company e ON b.`company_id`= e.id
		LEFT JOIN back_user f on a.last_collection_user_id = f.uuid
		<include refid="base_where"></include>
	</select>
	
	<select id="getOrderPage" resultMap="queryResultMap" parameterType="HashMap">
		SELECT t.id , t.order_id , t.user_id , t.loan_id , t.pay_id , t.dispatch_name , t.dispatch_time , t.last_collection_user_id , t.current_collection_user_id , t.current_overdue_level , t.overdueDays , t.m1_approve_id , t.m1OperateStatus , t.m2_approve_id , t.m2OperateStatus , t.m3_approve_id , t.m3OperateStatus , t.m4_approve_id , t.m4OperateStatus , t.m5_approve_id , t.m5OperateStatus , t.m6_approve_id , t.status , t.promise_repayment_time , t.last_collection_time , t.create_date , t.update_date , t.operator_name , t.remark , t.outside_person_id , t.before_status , t.outside_company_id , t.jxl_status , t.renew_status , t.jxl_apply_Time , t.jx_audit_ime , t.csstatus FROM mman_loan_collection_order t 
		WHERE 1=1
	</select>
	
	<select id="getOrderWithId" parameterType="String" resultType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">
		select id,order_id,overdueDays from mman_loan_collection_order where loan_id = #{orderId}
	</select>
   <!-- 减免状态更新 --> 	
	<update id="updateJmStatus" parameterType="com.info.web.pojo.cspojo.MmanLoanCollectionOrder">

			UPDATE mman_loan_collection_order

			<set>
   				 <if test="status != null">status=#{status},</if>
				update_date = now()

			</set>
 		WHERE id = #{id}
</update>
	<!--添加审核滞纳金-->
	<update id="updateReductionMoney" parameterType="HashMap">

		UPDATE mman_loan_collection_order a

		<set>
			<if test="reductionMoney != null"> a.reduction_money = #{reductionMoney},</if>
			update_date = now()
		</set>
		WHERE id = #{orderId}
	</update>
<!-- 审核减免状态更新 -->
	<update id="sveUpdateJmStatus" parameterType="HashMap">
		UPDATE mman_loan_collection_order
		<set> 
			<if test="status != null and status !=''">
				status=#{status,jdbcType=VARCHAR},
			</if>
			update_date = now()
		</set> 
		WHERE id = #{id,jdbcType=VARCHAR}
	</update>
	<!-- 减免定时修改订单金额 状态-->
	<update id="sveUpdateNotNull" parameterType="HashMap">
		UPDATE mman_loan_collection_order
		<set>
			<if test="status != null and status !=''">
				status=#{status},
			</if>
			<if test="reductionMoney != null and reductionMoney!='' ">
				reduction_money = #{reductionMoney},
			</if>
			update_date = now()
		</set>
		WHERE loan_id = #{loanId}
	</update>

	<!--中智诚 上传黑名单记录-->
	<select id="selectZzcBlackList" resultType="HashMap">
		SELECT
		m.update_date,
		m.`status`,
		m.overdueDays,
		m.create_date,
		u.realname,
		u.first_contact_name,
		u.first_contact_phone,
		u.second_contact_name,
		u.second_contact_phone,
		u.id_number,
		u.user_phone
		FROM
		mman_loan_collection_order m,
		mman_user_info u
		WHERE
		 m.status <![CDATA[ <> ]]> 4
		 AND m.user_id = u.id
	</select>

	<select id="getPerformanceResults" parameterType="java.util.HashMap" resultType="com.info.back.vo.PerformanceResult">
		SELECT * from (SELECT DATE(a.dispatch_time) as countDate, SUM(a.reduction_money) as reductionMoney, c.user_name as csName, c.user_mobile as mobile, count(1) as amount, c.group_level as groupLevel,
		sum(a.overdueDays) as overdueDays from mman_loan_collection_order a LEFT JOIN mman_user_loan b on a.loan_id=b.id
		LEFT JOIN back_user c on a.current_collection_user_id = c.uuid
		<where>
			<if test="loanStatus != null and loanStatus != ''">
				and b.loan_status in
				<foreach collection="loanStatus" open="("  close=")" item="status" separator=",">
					#{status}
				</foreach>
			</if>
			<if test="groupLevel != null and groupLevel != ''">
				and c.group_level=#{groupLevel}
			</if>
			<if test="isSys != null and isSys != ''">
				and a.`dispatch_name` = '系统'
			</if>
			<if test="isHand != null and isHand != ''">
				and a.`dispatch_name` != '系统'
			</if>
			<if test="updateS3 != null and updateS3 != ''">
				and DATE(a.dispatch_time) &lt; #{paramDate}
			</if>
			<if test="paramDate != null and paramDate != '' and updateS3 == null">
				and DATE(a.dispatch_time) &gt;= #{paramDate}
			</if>
		</where>
		 GROUP BY DATE(a.dispatch_time),a.current_collection_user_id) f ORDER BY f.countDate ASC
	</select>

	<select id="getIdByLoanId" resultType="com.info.back.vo.MmmanOrderId" parameterType="java.util.List">
		select id, loan_id loanId from mman_loan_collection_order where loan_id IN
		<foreach collection="list" open="(" close=")" item="item" separator=",">
			#{item}
		</foreach>
	</select>

	<select id="getOrderCount" resultType="Integer" parameterType="HashMap">
		select count(1) from mman_loan_collection_order
		<where>
			<if test="countBlank != null and countBlank != ''">
				repay_renewal_mark = 0
			</if>
		</where>
	</select>

	<select id="getLoanIds" resultType="Integer" parameterType="HashMap">
		SELECT loan_id from mman_loan_collection_order
		limit #{offset}, #{pageSize}
	</select>

	<select id="countIntoOrderNum" resultType="com.info.back.vo.CollectionSucCount">
		SELECT a.`current_overdue_level` groupLevel, b.`user_name` userName, count(1) intoNum  FROM `mman_loan_collection_order` a, `back_user` b
		WHERE a.`current_collection_user_id` = b.`uuid`
		<if test="startTime != null">
			and a.`dispatch_time` &gt;= #{startTime}
		</if>
		<if test="endTime != null">
			and a.`dispatch_time` &lt; #{endTime}
		</if>
		GROUP BY a.`current_overdue_level`, a.`current_collection_user_id`
	</select>

	<update id="updateOrderRenewCount" parameterType="java.util.Map">
		<foreach item="k" index="key" collection="dataMap.keys" separator=";" >
			UPDATE mman_loan_collection_order SET
			repay_renewal_mark = case status
			when 4 then ${dataMap[k]} + 1
			else ${dataMap[k]} end
			WHERE loan_id = #{k, jdbcType=VARCHAR}
		</foreach>
	</update>
</mapper>
