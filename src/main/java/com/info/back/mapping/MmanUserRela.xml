<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--      
	This file is automatically generated by autoCode(https://git.oschina.net/durcframework/autoCode)
-->
<mapper namespace="com.info.back.dao.IMmanUserRelaDao">
	<resultMap id="queryResultMap" type="com.info.web.pojo.cspojo.MmanUserRela">
		<result column="id" property="id" jdbcType="VARCHAR"/>
		<!-- 借款用户id -->
		<result column="user_id" property="userId" jdbcType="VARCHAR"/>
		<!-- 联系人类型（1 -直系亲属联系人、2-其他联系人，若为通讯录备份联系人这里不填） -->
		<result column="contacts_key" property="contactsKey" jdbcType="VARCHAR"/>
		<!-- 联系人关系（直系：1 -父亲 、2-母亲、3-儿子、4-女儿、5-配偶；其他：1 -同学、2-亲戚、3-同事、4-朋友、5-其他，若为通讯录备份联系人这里不填） -->
		<result column="rela_key" property="relaKey" jdbcType="VARCHAR"/>
		<!-- 联系人姓名 -->
		<result column="info_name" property="infoName" jdbcType="VARCHAR"/>
		<!-- 联系人电话 -->
		<result column="info_value" property="infoValue" jdbcType="VARCHAR"/>
		<!-- 关联紧急联系人标记，1是0否（为通讯录备份联系人这里不填） -->
		<result column="contactsFlag" property="contactsFlag" jdbcType="VARCHAR"/>
		<!-- 删除标记（'1'-已删除，'0'正常） -->
		<result column="del_flag" property="delFlag" jdbcType="CHAR"/>
		<!-- 联系人类型字典值（这里不用） -->
		<result column="contacts_value" property="contactsValue" jdbcType="VARCHAR"/>
		<!-- 联系人关系字典值（这里不用） -->
		<result column="rela_value" property="relaValue" jdbcType="VARCHAR"/>
		<!-- 这里不用 -->
		<result column="kv_vars" property="kvVars" jdbcType="VARCHAR"/>
		<!-- 归属地 -->
		<result column="phone_num_loc" property="phoneNumLoc" jdbcType="VARCHAR"/>
		<!-- 联系次数 -->
		<result column="call_cnt" property="callCnt" jdbcType="INTEGER"/>
		<!-- 主叫次数 -->
		<result column="call_out_cnt" property="callOutCnt" jdbcType="INTEGER"/>
		<!-- 被叫次数 -->
		<result column="call_in_cnt" property="callInCnt" jdbcType="INTEGER"/>
		<!-- 联系时间（分） -->
		<result column="call_len" property="callLen" jdbcType="VARCHAR"/>
		<!-- 主叫时间（分） -->
		<result column="call_out_len" property="callOutLen" jdbcType="VARCHAR"/>
		<!-- 被叫时间（分） -->
		<result column="call_in_len" property="callInLen" jdbcType="VARCHAR"/>
	</resultMap>
	
	<sql id="sqlMmanUserRelaColumns">
		ur.id AS id,
		ur.user_id AS userId,
		ur.contacts_key AS contactsKey,
		ur.rela_key AS relaKey,
		ur.info_name AS infoName,
		ur.info_value AS infoValue,
		ur.contactsFlag AS contactsFlag,
		ur.del_flag AS delFlag,
		ur.contacts_value AS contactsValue,
		ur.rela_value AS relaValue,
		ur.kv_vars AS kvVars,
		ur.phone_num_loc AS phoneNumLoc,
		ur.call_cnt AS callCnt,
		ur.call_out_cnt AS callOutCnt,
		ur.call_in_cnt AS callInCnt,
		ur.call_len AS callLen,
		ur.call_out_len AS callOutLen,
		ur.call_in_len AS callInLen
	</sql>
	
	<select id="findAllCount" parameterType="HashMap" resultType="Integer">
		SELECT count(1) from mman_user_rela ur
		LEFT JOIN mman_user_info ui
		ON ur.user_id=ui.id
		<where>
			1=1
		  	and ui.id =#{userId}
		</where>
		ORDER BY  ur.call_cnt desc
	</select>
	<select id="findAll" resultType="com.info.web.pojo.cspojo.MmanUserRela" parameterType="HashMap">
		SELECT
			 <include refid="sqlMmanUserRelaColumns"/>,
			 ui.realname AS realName
		FROM  mman_user_rela ur
		LEFT JOIN mman_user_info ui
		ON ur.user_id=ui.id
		<where>
			1=1 
			and ui.id =#{userId}
		</where>
		ORDER BY  ur.call_cnt desc
	</select>
	<!-- 自己 -->
	<select id="findAllList" resultType="com.info.web.pojo.cspojo.MmanUserRela" parameterType="HashMap">
	  SELECT
         <include refid="sqlMmanUserRelaColumns"/>,    		
         	 ui.realname AS realName
		FROM  mman_user_rela ur
		LEFT JOIN mman_user_info ui
		ON ur.user_id=ui.id
		<where>
			1=1 
			and ui.id =#{userId}
		</where>
		GROUP BY ur.info_value having count(1)>1 ORDER BY ur.info_value
	</select>
	<!-- 自己 -->
	<select id="findAllPageCount" resultType="Integer" parameterType="HashMap">
		SELECT count(1) from mman_user_rela ur
		LEFT JOIN mman_user_info ui
		ON ur.user_id=ui.id  		
      <where>
			1=1 
			and ui.id =#{userId}
     </where>
		GROUP BY ur.info_value having count(1)>1 ORDER BY ur.info_value
	</select>
	<select id="getList" resultType="com.info.web.pojo.cspojo.MmanUserRela" parameterType="HashMap">
		SELECT
			 <include refid="sqlMmanUserRelaColumns"/>,
			 ui.realname AS realName
		FROM  mman_user_rela ur
		LEFT JOIN mman_user_info ui
		ON ur.user_id=ui.id
		<where>
		ui.id =#{userId}
		</where>
		GROUP BY ur.info_value
		ORDER BY  ur.call_cnt desc limit 0,#{num}
		
	</select>
	
	<!-- 查询电话号码是否是借款人本人或其对应联系人的电话号码 -->
	<select id="getContactPhones" parameterType="String" resultMap="queryResultMap">
		select ur.info_name,ur.info_value from mman_user_rela ur
			LEFT JOIN mman_user_info ui
			ON ur.user_id=ui.id
			where ur.user_id = #{userId};
	</select>
	<!--根据userRelaId获取联系人-->
	<select id="getUserRealByUserId" parameterType="String" resultMap="queryResultMap">
		select <include refid="sqlMmanUserRelaColumns"/>
		from mman_user_rela ur
		where ur.id = #{userRelaId};
	</select>


	<!-- 保存,保存不为NULL的字段 -->
	<insert id="saveNotNull" parameterType="com.info.web.pojo.cspojo.MmanUserRela">
		<selectKey keyProperty="id" resultType="java.lang.String"
			order="BEFORE">
			select replace(uuid(),'-','') from dual
	</selectKey>
	INSERT INTO mman_user_rela 
		<trim prefix="(" suffix=")" suffixOverrides=","> 
			`id`,  
			<if test="userId != null">`user_id`,</if>  
			<if test="contactsKey != null">`contacts_key`,</if>  
			<if test="relaKey != null">`rela_key`,</if>  
			<if test="infoName != null">`info_name`,</if>  
			<if test="infoValue != null">`info_value`,</if>  
			<if test="contactsFlag != null">`contactsFlag`,</if>  
			<if test="delFlag != null">`del_flag`,</if>  
			<if test="contactsValue != null">`contacts_value`,</if>  
			<if test="relaValue != null">`rela_value`,</if>  
			<if test="kvVars != null">`kv_vars`,</if>  
			<if test="phoneNumLoc != null">`phone_num_loc`,</if>  
			<if test="callCnt != null">`call_cnt`,</if>  
			<if test="callOutCnt != null">`call_out_cnt`,</if>  
			<if test="callInCnt != null">`call_in_cnt`,</if>  
			<if test="callLen != null">`call_len`,</if>  
			<if test="callOutLen != null">`call_out_len`,</if>  
			<if test="callInLen != null">`call_in_len`,</if> 
		</trim>  
		<trim prefix="values (" suffix=")" suffixOverrides=","> 
			#{id,jdbcType=VARCHAR},  
			<if test="userId != null">#{userId,jdbcType=VARCHAR},</if>  
			<if test="contactsKey != null">#{contactsKey,jdbcType=VARCHAR},</if>  
			<if test="relaKey != null">#{relaKey,jdbcType=VARCHAR},</if>  
			<if test="infoName != null">#{infoName,jdbcType=VARCHAR},</if>  
			<if test="infoValue != null">#{infoValue,jdbcType=VARCHAR},</if>  
			<if test="contactsFlag != null">#{contactsFlag,jdbcType=VARCHAR},</if>  
			<if test="delFlag != null">#{delFlag,jdbcType=CHAR},</if>  
			<if test="contactsValue != null">#{contactsValue,jdbcType=VARCHAR},</if>  
			<if test="relaValue != null">#{relaValue,jdbcType=VARCHAR},</if>  
			<if test="kvVars != null">#{kvVars,jdbcType=VARCHAR},</if>  
			<if test="phoneNumLoc != null">#{phoneNumLoc,jdbcType=VARCHAR},</if>  
			<if test="callCnt != null">#{callCnt,jdbcType=INTEGER},</if>  
			<if test="callOutCnt != null">#{callOutCnt,jdbcType=INTEGER},</if>  
			<if test="callInCnt != null">#{callInCnt,jdbcType=INTEGER},</if>  
			<if test="callLen != null">#{callLen,jdbcType=VARCHAR},</if>  
			<if test="callOutLen != null">#{callOutLen,jdbcType=VARCHAR},</if>  
			<if test="callInLen != null">#{callInLen,jdbcType=VARCHAR},</if> 
		</trim> 
	</insert>
	<!-- 更新不为NULL的字段 -->
	<update id="updateNotNull" parameterType="com.info.web.pojo.cspojo.MmanUserRela">UPDATE mman_user_rela
		<set> 
			<if test="userId != null">user_id=#{userId,jdbcType=VARCHAR},</if>  
			<if test="contactsKey != null">contacts_key=#{contactsKey,jdbcType=VARCHAR},</if>  
			<if test="relaKey != null">rela_key=#{relaKey,jdbcType=VARCHAR},</if>  
			<if test="infoName != null">info_name=#{infoName,jdbcType=VARCHAR},</if>  
			<if test="infoValue != null">info_value=#{infoValue,jdbcType=VARCHAR},</if>  
			<if test="contactsFlag != null">contactsFlag=#{contactsFlag,jdbcType=VARCHAR},</if>  
			<if test="delFlag != null">del_flag=#{delFlag,jdbcType=CHAR},</if>  
			<if test="contactsValue != null">contacts_value=#{contactsValue,jdbcType=VARCHAR},</if>  
			<if test="relaValue != null">rela_value=#{relaValue,jdbcType=VARCHAR},</if>  
			<if test="kvVars != null">kv_vars=#{kvVars,jdbcType=VARCHAR},</if>  
			<if test="phoneNumLoc != null">phone_num_loc=#{phoneNumLoc,jdbcType=VARCHAR},</if>  
			<if test="callCnt != null">call_cnt=#{callCnt,jdbcType=INTEGER},</if>  
			<if test="callOutCnt != null">call_out_cnt=#{callOutCnt,jdbcType=INTEGER},</if>  
			<if test="callInCnt != null">call_in_cnt=#{callInCnt,jdbcType=INTEGER},</if>  
			<if test="callLen != null">call_len=#{callLen,jdbcType=VARCHAR},</if>  
			<if test="callOutLen != null">call_out_len=#{callOutLen,jdbcType=VARCHAR},</if>  
			<if test="callInLen != null">call_in_len=#{callInLen,jdbcType=VARCHAR},</if> 
		</set> WHERE id = #{id,jdbcType=VARCHAR}
	</update>
	<!-- 根据主键获取单条记录 -->
	<select id="get" resultMap="queryResultMap" parameterType="com.info.web.pojo.cspojo.MmanUserRela">SELECT t.id , t.user_id , t.contacts_key , t.rela_key , t.info_name , t.info_value , t.contactsFlag , t.del_flag , t.contacts_value , t.rela_value , t.kv_vars , t.phone_num_loc , t.call_cnt , t.call_out_cnt , t.call_in_cnt , t.call_len , t.call_out_len , t.call_in_len FROM mman_user_rela t WHERE id = #{id,jdbcType=VARCHAR}</select>
	<!-- 根据主键删除记录 -->
	<delete id="del" parameterType="com.info.web.pojo.cspojo.MmanUserRela">DELETE FROM mman_user_rela WHERE id = #{id,jdbcType=VARCHAR}</delete>
</mapper>
